<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2026 Ë∑®Âπ¥Ëâ∫ÊúØÁõõÂÖ∏ | Cinematic Experience</title>

  <!-- Tailwind + Icons + Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&family=Noto+Sans+SC:wght@300;500;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      --accent: #ff4d00;
      --glass-bg: rgba(8,8,8,0.64);
      --text-main: #f7f7f7;
    }
    html,body,#root { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(ellipse at 10% 10%, rgba(10,20,45,0.6), transparent 15%),
                  radial-gradient(ellipse at 90% 90%, rgba(6,10,20,0.45), transparent 15%),
                  linear-gradient(180deg, #000011 0%, #000 50%, #05020a 100%);
      color: var(--text-main);
      font-family: 'Noto Sans SC', sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow: hidden;
    }

    /* animated background gradient (slow) */
    .bg-animated {
      position: fixed; inset: 0; z-index: -20;
      background: linear-gradient(120deg, rgba(255,77,0,0.06), rgba(0,200,255,0.06), rgba(200,200,255,0.03));
      background-size: 300% 300%;
      animation: bgFlow 18s linear infinite;
      pointer-events: none;
    }
    @keyframes bgFlow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

    /* twinkling stars */
    .stars {
      position: fixed; inset: 0; z-index:-15; pointer-events:none;
      background-image: radial-gradient(white 1px, transparent 1px);
      background-size: 2px 2px;
      opacity: 0.06;
      filter: blur(0.6px);
      animation: starsTwinkle 6s ease-in-out infinite;
    }
    @keyframes starsTwinkle { 0%{opacity:0.04} 50%{opacity:0.09} 100%{opacity:0.04} }

    /* film grain */
    .film-grain {
      position: fixed; inset: 0; z-index: 60;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cfilter id='n'%3E%3CfeTurbulence baseFrequency='0.9' numOctaves='2'/%3E%3C/feTurbulence%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
      opacity: 0.06;
    }

    /* opening 2026 headline */
    .opening-2026 {
      font-family: 'Zhi Mang Xing', cursive;
      font-weight: 700;
      letter-spacing: -3px;
      display:inline-block;
      background: linear-gradient(135deg,#ff8c00 0%, #ffd700 35%, #00c8ff 75%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 8px 28px rgba(255,100,30,0.35));
      animation: breathe 4s ease-in-out infinite alternate;
    }
    @keyframes breathe { from{ transform: scale(1);} to{ transform: scale(1.035);} }

    /* glass card */
    .glass {
      background: var(--glass-bg);
      border-radius: 22px;
      padding: 28px;
      border: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(18px) saturate(140%);
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
      transition: transform 300ms ease, box-shadow 300ms ease;
    }
    .glass:active { transform: translateY(2px) scale(0.998); }

    .input-elegant{
      width:100%;
      padding:14px 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.04);
      text-align:center;
      font-weight:700;
      font-size:1.05rem;
      color:var(--text-main);
      transition: box-shadow 160ms ease, background 160ms ease;
    }
    .input-elegant:focus{ outline:none; box-shadow:0 0 26px rgba(255,77,0,0.12); border-color:var(--accent); background: rgba(255,255,255,0.06); }

    .btn-action {
      display:inline-flex; gap:10px; align-items:center; justify-content:center;
      background: linear-gradient(90deg,#ff4500,#ff8c00);
      padding:12px 20px; border-radius:12px; font-weight:800; letter-spacing:0.08em; text-transform:uppercase;
      cursor:pointer; border: none; color:#fff;
      transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease;
      box-shadow: 0 8px 30px rgba(255,77,0,0.12);
    }
    .btn-action:active{ transform: translateY(2px); }
    .btn-action.btn-icon { padding:8px; border-radius:10px; background: rgba(255,255,255,0.06); color: #fff; box-shadow:none; }

    /* flip card */
    .flip-plate {
      display:flex; gap:12px; align-items:center; justify-content:center;
      perspective: 1000px;
      user-select: none;
    }
    .flip-digit {
      min-width: 72px; width: clamp(64px, 16vw, 110px);
      height: clamp(84px, 22vw, 140px);
      border-radius: 12px;
      position: relative;
      background: linear-gradient(180deg,#0f1720,#070707);
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 18px 40px rgba(0,0,0,0.8), inset 0 6px 12px rgba(255,255,255,0.02);
      display:flex; align-items:center; justify-content:center; font-family:'JetBrains Mono', monospace; font-size: clamp(1.6rem, 6vw, 3rem); font-weight:800; color:var(--text-main);
      overflow: hidden;
    }
    .sep-dot { font-size:1.35rem; margin: 0 6px; opacity:0.8; }

    /* flipping animation: we create front/back panels */
    .digit-inner { position: absolute; inset: 0; display:flex; flex-direction:column; }
    .digit-top, .digit-bottom { height:50%; display:flex; align-items:center; justify-content:center; padding:8px; box-sizing:border-box; overflow:hidden; }
    .digit-top { border-bottom: 1px solid rgba(255,255,255,0.03); transform-origin: bottom; }
    .digit-bottom { transform-origin: top; }

    .flip-anim .digit-top { animation: flipTop 560ms cubic-bezier(.2,.9,.2,1) forwards; }
    .flip-anim .digit-bottom { animation: flipBottom 560ms cubic-bezier(.2,.9,.2,1) forwards; }
    @keyframes flipTop { 0%{ transform: rotateX(0deg);} 100%{ transform: rotateX(-90deg); } }
    @keyframes flipBottom { 0%{ transform: rotateX(90deg);} 100%{ transform: rotateX(0deg);} }

    /* result title splash */
    .result-2026 {
      font-family: 'Zhi Mang Xing', cursive;
      font-size: clamp(4rem, 20vw, 14rem);
      background: linear-gradient(165deg,#ff3a00 0%, #ffd700 30%, #1e90ff 80%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: url(#ultra-oil-brush) drop-shadow(0 12px 36px rgba(0,0,0,0.6));
      animation: colorFlow 10s linear infinite;
      line-height:0.85;
      transition: transform 300ms ease;
    }
    @keyframes colorFlow { 0%{background-position:0% 50%} 100%{background-position:200% 50%} }

    /* music control bar */
    .music-bar {
      display:flex; gap:8px; align-items:center; padding:8px 10px; border-radius:999px;
      background: rgba(0,0,0,0.35); backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.03);
    }
    .music-slider { width:120px; }

    /* small helpers */
    .sr-only{ position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }
    .muted { opacity: 0.6; }
    .pointer { cursor:pointer; }
    .small-note { font-size: 12px; color: rgba(255,255,255,0.45); }

    /* responsive tweaks */
    @media (max-width:640px){
      .glass { padding: 18px; border-radius: 16px; }
      .opening-2026 { font-size: 96px; }
      .music-slider { width: 90px; }
    }
  </style>

  <!-- tiny SVG filter for result text (oil brush) -->
  <svg style="position:absolute;width:0;height:0" aria-hidden="true">
    <defs>
      <filter id="ultra-oil-brush" x="-20%" y="-20%" width="140%" height="140%">
        <feTurbulence type="fractalNoise" baseFrequency="0.08" numOctaves="4" result="n"/>
        <feDisplacementMap in="SourceGraphic" in2="n" scale="20" />
        <feGaussianBlur stdDeviation="0.4"/>
      </filter>
    </defs>
  </svg>
</head>

<body>
  <div class="bg-animated" aria-hidden="true"></div>
  <div class="stars" aria-hidden="true"></div>
  <div class="film-grain" aria-hidden="true"></div>

  <div id="root" class="h-full w-full"></div>

  <script type="text/babel">
  const { useState, useEffect, useRef } = React;

  // Background music raw URL on GitHub (raw.githubusercontent.com)
  // If you move the file, update this URL accordingly.
  const BGM_URL = "https://raw.githubusercontent.com/caoxing7115/heart-animation/main/%E6%B5%86%E6%9E%9C.mp3";

  const BLESSINGS = [
    { cn: "‰∏áÁâ©Êõ¥Êñ∞ÔºåÊóßÁñæÂΩìÊÑàÔºåÈïøÂÆâÂ∏∏ÂÆâ„ÄÇ", en: "Renewal for all, healing for old pains, lasting peace for you.", icon: "üå±" },
    { cn: "ÂæÄ‰∫ãÊ∏ÖÈõ∂ÔºåÁà±ÊÅ®ÈöèÊÑèÔºåËøéÊé•Êñ∞ÂÖâ„ÄÇ", en: "Reset the past, let go of the mundane, embrace the new light.", icon: "‚ú®" },
    { cn: "Á•ù‰Ω†2026ÔºöÁúºÈáåÊúâÊòüËæ∞ÔºåÂøÉ‰∏≠ÊúâÂ§ßÊµ∑„ÄÇ", en: "2026: May stars light your eyes and the ocean fill your heart.", icon: "üåä" },
    { cn: "Â≤ÅÂ≤ÅÂ∏∏Ê¨¢ÊÑâÔºåÂπ¥Âπ¥ÁöÜËÉúÊÑè„ÄÇ", en: "Joy in every hour, victory in every year.", icon: "üçä" },
    { cn: "ÂáõÂÜ¨Êï£Â∞ΩÔºåÊòüÊ≤≥ÈïøÊòéÔºåÊñ∞Âπ¥È°∫ÈÅÇ„ÄÇ", en: "Winter fades, the galaxy remains bright, all goes well.", icon: "üåå" },
    { cn: "Êñ∞ÁöÑ‰∏ÄÂπ¥ÔºåÂ•îËµ¥Â±±Êµ∑Ôºå‰øùÊåÅÁÉ≠Áà±„ÄÇ", en: "Heading for the mountains and seas, keep your fire burning.", icon: "üèîÔ∏è" },
    { cn: "ÊÑøÊñ∞Âπ¥ÔºåËÉúÊóßÂπ¥ÔºåÂ§öÂñú‰πêÔºåÈïøÂÆâÂÆÅ„ÄÇ", en: "May the new year excel the old, full of joy and tranquility.", icon: "üéä" },
    { cn: "‰∏çÊúüËÄåÈÅáÔºå‰∏çË®ÄËÄåÂñªÔºåÂ¶ÇÊúüËÄåËá≥„ÄÇ", en: "Unexpected encounters, silent bonds, arriving on schedule.", icon: "‚è≥" },
    { cn: "ÊÑø‰Ω†Ê≠§ÁîüÂ∞ΩÂÖ¥ÔºåËµ§ËØöÂñÑËâØ„ÄÇ", en: "May you live to the fullest, sincere and kind to the core.", icon: "‚ù§Ô∏è" },
    { cn: "Êñ∞ÁöÑ‰∏ÄÂπ¥ÔºåË¶ÅÊääÂºÄÂøÉÊîæÂú®Á¨¨‰∏Ä‰Ωç„ÄÇ", en: "In the coming year, prioritize your happiness above all.", icon: "ü•≥" },
    { cn: "Â±±È´òÊ∞¥ÈïøÔºåÊÑø‰Ω†ÊàëÈ°∂Â≥∞Áõ∏ËßÅ„ÄÇ", en: "The peak awaits, may we meet there in triumph.", icon: "üö©" },
    { cn: "ÊâÄÂæóÁöÜÊâÄÊÑøÔºåÊâÄË°åÁöÜÂù¶ÈÄî„ÄÇ", en: "All gains as desired, all paths smooth and free.", icon: "üõ£Ô∏è" },
    { cn: "ÊÑø2026Âπ¥ÁöÑ‰Ω†ÔºåÊ¥ªÂæóÂÉèÂÖâÔºåÁÅøÁÉÇÂ§∫ÁõÆ„ÄÇ", en: "In 2026, live like light‚Äîbrilliant and dazzling.", icon: "‚òÄÔ∏è" },
    { cn: "‰∏çË¥üÁÉ≠Áà±ÔºåÂ•îÂêëÊú™Êù•„ÄÇ", en: "Live up to your passion, sprint toward the future.", icon: "‚ö°" },
    { cn: "2026ÔºåÂºÄÂêØÊó†ÈôêÂèØËÉΩ„ÄÇ", en: "2026: Unlocking infinite possibilities within you.", icon: "üóùÔ∏è" },
    { cn: "ÁÉüÁÅ´‰∫∫Èó¥ÔºåÂ≤ÅÂ≤ÅÂπ¥Âπ¥„ÄÇ", en: "Amidst the earthly fireworks, year after year.", icon: "üéÜ" },
    { cn: "Ë∑®ËøáÊòüÊ≤≥ÔºåËøàÂêëÊú™Êù•„ÄÇ", en: "Stride across the galaxy into a brand new future.", icon: "üõ∏" },
    { cn: "ÁîüÊ¥ªÊòéÊúóÔºå‰∏áÁâ©ÂèØÁà±„ÄÇ", en: "Life is bright, and all things are endearing.", icon: "üêæ" },
    { cn: "ÊÑøÊñ∞Âπ¥ÔºöÊó†ÂøßÊó†ËôëÔºåÊâÄÂæóÁöÜÊÑø„ÄÇ", en: "May your year be carefree, granting every wish.", icon: "üß∏" },
    { cn: "Á•ù‰Ω†ÔºöÁúºÈáåÊúâÁÅ´ÔºåÂøÉ‰∏≠ÊúâÂÖâ„ÄÇ", en: "Fire in your vision, light in your soul.", icon: "üî•" }
  ];

  /* ---------- FlipDigit component: animates when value changes ---------- */
  function FlipDigit({ value }) {
    const [prev, setPrev] = useState(value);
    const [anim, setAnim] = useState(false);

    useEffect(() => {
      if (value !== prev) {
        setAnim(true);
        const t = setTimeout(() => { setAnim(false); setPrev(value); }, 560);
        return () => clearTimeout(t);
      }
    }, [value, prev]);

    return (
      <div className={"flip-digit " + (anim ? "flip-anim" : "")} aria-hidden>
        <div className="digit-inner">
          <div className="digit-top" aria-hidden>{anim ? prev : value}</div>
          <div className="digit-bottom" aria-hidden>{anim ? value : prev}</div>
        </div>
      </div>
    );
  }

  /* ---------- Firework-like background with canvas (subtle) ---------- */
  function FireworkCanvas({ active }) {
    const cRef = useRef(null);
    useEffect(() => {
      const canvas = cRef.current;
      if (!canvas || !active) return;
      const ctx = canvas.getContext('2d');
      let particles = [];
      const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
      resize();
      let rafId = null;
      const loop = () => {
        ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.fillRect(0,0,canvas.width,canvas.height);
        particles = particles.filter(p => p.alpha > 0.02);
        particles.forEach(p => {
          p.x += p.vx; p.y += p.vy; p.vy += 0.06; p.alpha -= 0.015;
          ctx.globalAlpha = p.alpha; ctx.fillStyle = p.color;
          ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
        });
        if (Math.random() < 0.06) {
          const x = Math.random()*canvas.width, y = Math.random()*canvas.height*0.6;
          const colors = ['#ff4d00','#ffd700','#00ccff','#ff77aa','#77ff66'];
          for (let i=0;i<60;i++){
            const a = Math.random()*Math.PI*2, s = Math.random()*4+1;
            particles.push({ x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,alpha:0.9,color:colors[Math.floor(Math.random()*colors.length)],size:1+Math.random()*2 });
          }
        }
        rafId = requestAnimationFrame(loop);
      };
      window.addEventListener('resize', resize);
      loop();
      return () => { window.removeEventListener('resize', resize); cancelAnimationFrame(rafId); };
    }, [active]);
    return <canvas ref={cRef} className="fixed inset-0 -z-10 pointer-events-none" aria-hidden />;
  }

  /* ---------- Small confetti when result shows ---------- */
  function Confetti({ playing }) {
    const cRef = useRef(null);
    useEffect(() => {
      const canvas = cRef.current; if (!canvas) return;
      const ctx = canvas.getContext('2d'); let raf; let pieces = [];
      const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
      resize();
      const spawn = () => {
        const colors = ['#ff4d00','#ffd700','#00ccff','#ffffff','#ff77aa','#77ff66'];
        for (let i=0;i<80;i++){
          pieces.push({
            x: Math.random() * canvas.width,
            y: -20 - Math.random()*200,
            vx: (Math.random()-0.5)*3,
            vy: 1 + Math.random()*3,
            rot: Math.random()*360,
            vr: (Math.random()-0.5)*12,
            w: 6 + Math.random()*10,
            h: 8 + Math.random()*12,
            color: colors[Math.floor(Math.random()*colors.length)],
            life: 0
          });
        }
      };
      const loop = () => {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        pieces.forEach((p, i) => {
          p.x += p.vx; p.y += p.vy; p.vy += 0.04; p.rot += p.vr*0.02; p.life++;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180);
          ctx.fillStyle = p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
          ctx.restore();
          if (p.y > canvas.height + 50 || p.life > 400) pieces.splice(i,1);
        });
        raf = requestAnimationFrame(loop);
      };
      if (playing) { spawn(); loop(); window.addEventListener('resize', resize); }
      return () => { cancelAnimationFrame(raf); window.removeEventListener('resize', resize); pieces=[]; };
    }, [playing]);

    return <canvas ref={cRef} className="fixed inset-0 pointer-events-none z-40" aria-hidden />;
  }

  /* ---------- Main App ---------- */
  function App(){
    const [scene, setScene] = useState('opening'); // opening | video | result
    const [name, setName] = useState('');
    const [wish, setWish] = useState(null);
    const [timeLeft, setTimeLeft] = useState({ d:'0', h:'00', m:'00', s:'00' });
    const [videoMuted, setVideoMuted] = useState(true);
    const [bgmPlaying, setBgmPlaying] = useState(false);
    const [bgmVolume, setBgmVolume] = useState(0.48);
    const videoRef = useRef(null);
    const audioRef = useRef(null);
    const cardRef = useRef(null);
    const [confettiOn, setConfettiOn] = useState(false);

    useEffect(() => {
      // countdown - ensure using explicit date string (local timezone)
      const target = new Date('2026-01-01T00:00:00');
      const tick = () => {
        const diff = target - new Date();
        if (diff <= 0) {
          setTimeLeft({ d:'0', h:'00', m:'00', s:'00' });
        } else {
          setTimeLeft({
            d: String(Math.floor(diff / 86400000)),
            h: String(Math.floor((diff % 86400000) / 3600000)).padStart(2,'0'),
            m: String(Math.floor((diff % 3600000) / 60000)).padStart(2,'0'),
            s: String(Math.floor((diff % 60000) / 1000)).padStart(2,'0'),
          });
        }
      };
      tick();
      const id = setInterval(tick, 1000);
      return () => clearInterval(id);
    }, []);

    useEffect(() => {
      // sync video muted state when changed
      if (videoRef.current) videoRef.current.muted = !!videoMuted;
    }, [videoMuted]);

    useEffect(() => {
      if (audioRef.current) audioRef.current.volume = bgmVolume;
    }, [bgmVolume]);

    useEffect(() => { // keyboard shortcuts
      const onKey = (e) => {
        if (e.key === 'Enter') {
          if (scene === 'opening') startAction();
        } else if (e.key === 'Escape') {
          setScene('opening');
        } else if (e.key === 'm' || e.key === 'M') {
          toggleBgm();
        }
      };
      window.addEventListener('keydown', onKey);
      return () => window.removeEventListener('keydown', onKey);
    }, [scene, name, bgmPlaying]);

    // attempt to play bgm; browsers may block autoplay until user interacts
    async function tryPlayBgm() {
      if (!audioRef.current) return;
      try {
        await audioRef.current.play();
        setBgmPlaying(true);
      } catch (err) {
        // autoplay blocked ‚Äî will play on explicit user interaction
        setBgmPlaying(false);
      }
    }

    function toggleBgm() {
      if (!audioRef.current) return;
      if (bgmPlaying) {
        audioRef.current.pause();
        setBgmPlaying(false);
      } else {
        audioRef.current.play().then(()=>setBgmPlaying(true)).catch(()=>setBgmPlaying(false));
      }
    }

    function startAction(){
      if (!name.trim()) {
        // gentle shake effect on the input
        const el = document.getElementById('nameInput');
        if (el) {
          el.animate([{ transform: 'translateX(-6px)' },{ transform: 'translateX(6px)' },{ transform: 'translateX(0px)' }], { duration: 300 });
          el.focus();
        }
        return;
      }
      const sel = BLESSINGS[Math.floor(Math.random()*BLESSINGS.length)];
      setWish(sel);
      setScene('video');

      // try to play bgm and video (safe to call; browser will require interaction)
      tryPlayBgm();
      setTimeout(()=> {
        try { videoRef.current && videoRef.current.play(); } catch(e){}
      }, 120);
    }

    function onVideoEnd(){
      setScene('result');
      setConfettiOn(true);
      setTimeout(()=>setConfettiOn(false),7000);
    }

    function skipToResult(){
      if (videoRef.current) { try { videoRef.current.pause(); } catch(e){} }
      setScene('result');
      setConfettiOn(true);
      setTimeout(()=>setConfettiOn(false),7000);
    }

    async function exportCard(){
      if (!cardRef.current) return;
      // use html2canvas (already loaded)
      const canvas = await html2canvas(cardRef.current, { scale: 2, backgroundColor: null });
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = `Á•ùÁ¶èÂç°-${(name || 'Friend')}-2026.png`;
      a.click();
    }

    async function shareCard(){
      if (navigator.share && cardRef.current){
        try {
          // try to create blob via canvas
          const canvas = await html2canvas(cardRef.current, { scale:2, backgroundColor: null });
          const blob = await new Promise(res=>canvas.toBlob(res, 'image/png'));
          const filesArray = [ new File([blob], `Á•ùÁ¶èÂç°-${name||'Friend'}-2026.png`, { type: blob.type }) ];
          await navigator.share({ files: filesArray, title: 'Êñ∞Âπ¥Á•ùÁ¶è', text: `Áªô ${name || '‰Ω†'} ÁöÑÊñ∞Âπ¥Á•ùÁ¶è` });
        } catch (err) {
          console.warn('share failed', err);
          alert('ÂΩìÂâçËÆæÂ§á‰∏çÊîØÊåÅÁõ¥Êé•ÂàÜ‰∫´ÔºåÂ∑≤ÁîüÊàêÂõæÁâá‰æõ‰∏ãËΩΩ„ÄÇ');
          exportCard();
        }
      } else {
        exportCard();
      }
    }

    // parallax for card and title
    useEffect(()=> {
      const onMove = (e) => {
        const x = (e.clientX / window.innerWidth - 0.5) * 20;
        const y = (e.clientY / window.innerHeight - 0.5) * 10;
        const title = document.querySelector('.result-2026');
        if (title) title.style.transform = `translate3d(${x/2}px,${y/2}px,0) rotate(${x/60}deg)`;
        if (cardRef.current) cardRef.current.style.transform = `translate3d(${x/8}px,${y/8}px,0)`;
      };
      window.addEventListener('mousemove', onMove);
      return ()=>window.removeEventListener('mousemove', onMove);
    }, []);

    return (
      <div className="w-full h-full relative">
        <FireworkCanvas active={scene === 'opening' || scene === 'result'} />
        <audio ref={audioRef} src={BGM_URL} loop crossOrigin="anonymous" playsInline preload="auto" />
        <div className="absolute top-4 right-4 z-60 flex gap-3 items-center">
          <div className="music-bar" role="toolbar" aria-label="ËÉåÊôØÈü≥‰πêÊéßÂà∂">
            <button className="btn-action btn-icon" onClick={() => { toggleBgm(); }} title="Êí≠Êîæ / ÊöÇÂÅúËÉåÊôØÈü≥‰πê" aria-pressed={bgmPlaying}>
              <i className={"fa " + (bgmPlaying ? "fa-pause" : "fa-play")}></i>
            </button>
            <div className="small-note muted">BGM</div>
            <input className="music-slider" type="range" min="0" max="1" step="0.01" value={bgmVolume} onChange={(e)=>{ setBgmVolume(Number(e.target.value)); if (audioRef.current) audioRef.current.volume = Number(e.target.value); }} aria-label="ËÉåÊôØÈü≥‰πêÈü≥Èáè" />
            <button className="btn-action btn-icon" onClick={()=>{ setBgmVolume(v=>{ const nv = v>0 ? 0 : 0.48; if (audioRef.current) audioRef.current.volume = nv; return nv; }); }} title="ÈùôÈü≥/ÂèñÊ∂àÈùôÈü≥">
              <i className={"fa " + (bgmVolume===0 ? "fa-volume-xmark" : "fa-volume-high")}></i>
            </button>
          </div>
        </div>

        <div className="absolute inset-0 flex items-center justify-center p-6">
          {scene === 'opening' && (
            <div className="w-full max-w-4xl mx-auto flex flex-col items-center justify-center gap-6">
              <h1 className="opening-2026 text-center" style={{ fontSize: 'clamp(48px, 14vw, 120px)' }}>2026</h1>

              <div className="flex flex-col items-center glass">
                <div className="flip-plate mb-4" role="timer" aria-live="polite" aria-atomic="true">
                  <FlipDigit value={timeLeft.h} />
                  <div className="sep-dot">:</div>
                  <FlipDigit value={timeLeft.m} />
                  <div className="sep-dot">:</div>
                  <FlipDigit value={timeLeft.s} />
                </div>

                <div className="text-sm muted tracking-widest mb-4 text-center">Countdown ‚Ä¢ {timeLeft.d} Days ‚Ä¢ {timeLeft.h} : {timeLeft.m} : {timeLeft.s}</div>

                <div className="w-full max-w-md">
                  <label className="sr-only" htmlFor="nameInput">ÂßìÂêç</label>
                  <input id="nameInput" className="input-elegant mb-4" placeholder="Âú®Ê≠§ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêçÔºàÊúÄÂ§ö10Â≠óÔºâ" maxLength={10}
                    value={name} onChange={(e)=>setName(e.target.value)} aria-label="ËæìÂÖ•ÂßìÂêçÁî®‰∫éÂÆöÂà∂Á•ùÁ¶è" />
                  <div className="flex gap-3">
                    <button className="btn-action flex-1" onClick={() => { startAction(); }} aria-label="ÂºÄÂêØÊñ∞Âπ¥ÂØÑËØ≠">
                      <span>ÂºÄÂêØÊñ∞Âπ¥ÂØÑËØ≠</span>
                    </button>

                    <button className="btn-action btn-icon" onClick={()=>{
                      // toggle videoMuted state and keep videoRef in sync
                      setVideoMuted(v => {
                        const nv = !v;
                        if (videoRef.current) videoRef.current.muted = nv;
                        return nv;
                      });
                    }} aria-pressed={videoMuted} title="ÂàáÊç¢ËßÜÈ¢ëÈùôÈü≥">
                      <i className={"fa "+ (videoMuted ? "fa-volume-xmark" : "fa-volume-high")}></i>
                    </button>
                  </div>
                  <div className="mt-3 small-note text-center">Êåâ Enter Âø´ÈÄüÂêØÂä® ‚Ä¢ Esc ËøîÂõû ‚Ä¢ M ÂàáÊç¢Èü≥‰πê</div>
                </div>
              </div>
              <div className="text-xs text-white/30 uppercase tracking-widest">Art Direction ‚Ä¢ Happy New Year 2026</div>
            </div>
          )}

          {scene === 'video' && (
            <div className="fixed inset-0 z-50 bg-black flex items-center justify-center">
              <div className="absolute top-4 right-4 z-60 flex gap-2">
                <button className="btn-action btn-icon" onClick={()=>{
                  setVideoMuted(v => {
                    const nv = !v;
                    if (videoRef.current) videoRef.current.muted = nv;
                    return nv;
                  });
                }} aria-pressed={videoMuted} title="ÈùôÈü≥/ÂèñÊ∂àÈùôÈü≥">
                  <i className={"fa " + (videoMuted ? "fa-volume-xmark":"fa-volume-high")}></i>
                </button>
                <button className="btn-action btn-icon" onClick={()=>{ skipToResult(); }} title="Ë∑≥Ëøá">
                  <i className="fa fa-forward"></i>
                </button>
              </div>

              <video ref={videoRef} className="w-full h-full object-cover" playsInline autoPlay muted={videoMuted} onEnded={onVideoEnd}>
                <!-- Â¶ÇÊûú‰Ω†ÊúâËá™Âà∂ÁöÑËßÜÈ¢ëÔºåÊääÊñá‰ª∂ÂêçÊàñË∑ØÂæÑÊõøÊç¢Âà∞ËøôÈáå -->
                <source src="12Êúà31Êó•.mp4" type="video/mp4" />
                ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅ video Ê†áÁ≠æ„ÄÇ
              </video>
            </div>
          )}

          {scene === 'result' && wish && (
            <div className="flex flex-col items-center gap-8 w-full">
              <div className="mb-[-2.5rem] opacity-20 tracking-[3em] text-[10px] uppercase select-none">Start of the Era</div>
              <div className="result-2026 select-none">2026</div>

              <div ref={cardRef} className="glass w-full max-w-2xl p-8 flex flex-col items-center gap-6" role="article" aria-label="Á•ùÁ¶èÂç°">
                <div className="text-7xl">{wish.icon}</div>
                <div className="text-2xl sm:text-4xl font-extrabold text-white leading-snug text-center">‚Äú {wish.cn} ‚Äù</div>
                <div className="text-sm sm:text-lg muted italic text-center">{wish.en}</div>

                <div className="w-full border-t border-white/5 pt-6 flex items-center justify-between gap-4">
                  <div>
                    <div className="text-orange-400 text-xs font-bold tracking-widest uppercase">Dedicated To</div>
                    <div className="font-black text-xl">{name || 'Friend'}</div>
                  </div>

                  <div className="flex gap-3 items-center">
                    <button className="btn-action" onClick={exportCard} title="‰∏ãËΩΩÁ•ùÁ¶èÂç°‰∏∫ÂõæÁâá">‰∏ãËΩΩ</button>
                    <button className="btn-action" onClick={shareCard} title="ÂàÜ‰∫´Á•ùÁ¶èÂç°">ÂàÜ‰∫´</button>
                    <button className="btn-action btn-icon" onClick={()=>{ setScene('opening'); setWish(null); }} title="ÈáçÁΩÆ">
                      <i className="fa fa-rotate-left"></i>
                    </button>
                  </div>
                </div>
              </div>

            </div>
          )}
        </div>

        <Confetti playing={confettiOn} />
      </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<App />);
  </script>
</body>
</html>
